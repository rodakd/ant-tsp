var T=Object.defineProperty;var E=(p,o,c)=>o in p?T(p,o,{enumerable:!0,configurable:!0,writable:!0,value:c}):p[o]=c;var i=(p,o,c)=>(E(p,typeof o!="symbol"?o+"":o,c),c);(function(){"use strict";const c=(t,e)=>{const[r,a]=t,[s,n]=e;if(a===n&&r===s)return 0;const u=Math.PI*a/180,h=Math.PI*n/180,d=r-s,M=Math.PI*d/180;let l=Math.sin(u)*Math.sin(h)+Math.cos(u)*Math.cos(h)*Math.cos(M);return l>1&&(l=1),l=Math.acos(l),l=l*180/Math.PI,l*60*1.1515*1.609344},m=t=>t!=null&&t.length?t.slice(0,-1).map((e,r)=>c(e,t[r+1])).reduce((e,r)=>e+r,0):0,g=t=>{let e=new f;onmessage=async r=>{var s;if(!((s=r==null?void 0:r.data)!=null&&s.type))return;const a=r.data;switch(a.type){case"run":e=new f,e.params=a.params,e.markers=a.markers,e.speedPercent=a.speedPercent,e.performanceMode=a.performanceMode,e.iterationsLimit=a.iterationsLimit,t(e,a.params).catch(()=>null);break;case"stop":e.running=!1;break;case"pause":e.paused=!0;break;case"resume":e.paused=!1;break;case"changeSpeed":e.speedPercent=a.speedPercent}}};class f{constructor(){i(this,"paused",!1);i(this,"running",!0);i(this,"bestTour",null);i(this,"currentTour",null);i(this,"iteration",0);i(this,"markers",[]);i(this,"params",{});i(this,"speedPercent",60);i(this,"performanceMode",!1);i(this,"iterationsLimit",null)}updateBestTour(e){this.bestTour=e,this.appDispatch({type:"updateBestTour",bestTour:e})}updateIteration(e){if(this.iteration=e,this.iterationsLimit&&this.iteration>this.iterationsLimit)return this.end();this.appDispatch({type:"updateIteration",iteration:e})}updateCurrentTour(e){this.currentTour=e,this.appDispatch({type:"updateCurrentTour",currentTour:e})}async sleep(){if(!this.running)throw"Stopped";if(this.performanceMode)return;for(;this.paused&&this.running;)await new Promise(r=>setTimeout(r,200));const e=500-this.speedPercent/100*500;return new Promise(r=>setTimeout(r,e))}log(e){this.appDispatch({type:"log",toLog:JSON.stringify(e)})}error(e){this.appDispatch({type:"error",text:e})}calculateCost(e){return m(e)}end(){throw this.appDispatch({type:"end"}),this.running=!1,"Stopped"}appDispatch(e){if(!this.running)throw"Stopped";postMessage(e)}}async function w(t){const e=[...t.markers];e.push(e[0]),t.updateBestTour(e);let r=t.calculateCost(e),a=!0;for(;a;){a=!1;for(let s=1;s<e.length-1;s++)for(let n=s+1;n<e.length-1;n++){t.updateIteration(t.iteration+1);const u=e.slice(s,n+1);u.reverse(),e.splice(s,n+1-s,...u);const h=e,d=t.calculateCost(h);t.updateCurrentTour([...e.slice(0,s),...e.slice(s+1,n),...e.slice(n+1),e[s-1],e[s],e[s+1],e[n-1],e[n],e[n+1]]),await t.sleep(),d<r?(a=!0,r=d,t.updateBestTour(h)):(u.reverse(),e.splice(s,n+1-s,...u)),t.updateCurrentTour(e),await t.sleep()}}t.end()}g(w)})();
